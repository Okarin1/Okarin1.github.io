---
title: ES6-ES12(二)
date: 2022-02-14
categories:
 - JavaScript
tags:
 - JavaScript
 - Set
 - WeakSet
---

<!-- more -->


## Set的基本使用

在ES6之前，我们存储数据的结构主要有两种：数组、对象。

* 在ES6中新增了另外两种数据结构：Set、Map，以及它们的另外形式WeakSet、WeakMap。

Set是一个新增的数据结构，可以用来保存数据，类似于数组，但是和数组的区别是元素不能重复。

* 创建Set我们需要通过Set构造函数（暂时没有字面量创建的方式）。

```js
//10 20 30 40 

const set = new Set()
set.add(10)
set.add(20)
set.add(30)
set.add(40)

//Set的元素不能重复
set.add(10)

//添加不同的对象
set.add({})
set.add({})


console.log(set)//Set { 10, 20, 30, 40, {}, {} }

```

### Set的应用场景

* 数组去重

```js
const arr = [33,10,26,33,26]
const arrSet = new Set(arr)
console.log(arrSet)//Set { 33, 10, 26 }
```

```js

const arr = [33,10,26,33,26]

const newArr1 = Array.from(new Set(arr))
const newArr2 = [...new Set(arr)]

console.log(newArr1,newArr2)//[ 33, 10, 26 ]
```

### Set的常见属性与方法

* **size**：返回Set中元素的个数；

* **add（value**）：添加某个元素，返回Set对象本身；
* **delete（value）**：从set中删除和这个值相等的元素，返回boolean类型；
* **has（value）**：判断set中是否存在某个元素，返回boolean类型； 
* **forEach（callback，［，thisArg］）**：通过forEach遍历set；
* **clear()**：清空set中所有的元素，没有返回值；

 ```js
 const arr = [33,10,26,33,26]
 const arrSet = new Set(arr)
 
 console.log(arrSet.size)//3
 
 arrSet.add(100)
 console.log(arrSet)//Set { 33, 10, 26, 100 }
 
 arrSet.delete(100)
 console.log(arrSet)//Set { 33, 10, 26 }
 
 console.log(arrSet.has(33),arrSet.has(100))//true false
 
 arrSet.forEach((item) => {
   console.log(item)
 })
 //33
 //10
 //26
 
 arrSet.clear()
 console.log(arrSet)//Set {}
 ```



另外Set是支持for of 的遍历的。

```js
for( const s of arrSet){
    console.log(s)
}
//33
//10
//26
```

## WeakSet的使用

和 Set 类似的另外一个数据结构称之为 WeakSet ，也是内部元素不能重复的数据结构。那么和Set有什么区别呢？

* 区别一：WeakSet 中只能存放对象类型，不能存放基本数据类型；

```js
const weakSet = new WeakSet()
weakSet.add(10)//TypeError: Invalid value used in weak set
```

* 区别二：WeakSet 对元素的引用是**弱引用**，如果没有其他引用对某个对象进行引用，那么 GC 可以对该对象进行回收；

### 强引用和弱引用

当指向是强引用时，有指向时，GC不会回收。而弱引用的指向会被GC回收。

![image-20220214174513104](https://s2.loli.net/2022/02/14/tiF46CXB7TVHYeu.png)

### WeakSet常见的方法：

* **add(value)**：添加某个元素，返回WeakSet对象本身；
* **delete(value)**：从WeakSet中删除和这个值相等的元素，返回boolean类型；
* **has(value)**：判断WeakSet中是否存在某个元素，返回boolean类型；

### WeakSet的应用场景

**注意：** WeakSet不能遍历

* 因为WeakSet只是对对象的弱引用，如果我们遍历获取到其中的元素，那么有可能造成对象不能正常的销毁。
* 所以存储到WeakSet中的对象是没办法获取的。  









